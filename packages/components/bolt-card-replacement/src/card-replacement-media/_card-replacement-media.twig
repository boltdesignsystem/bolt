{% set _card_replacement_image = media.image %}
{% set _card_replacement_video = media.video %}
{% set attributes = create_attribute(media.attributes|default({})) %}

{% set _card_replacement_media_content = media.content %}

{% if horizontal and _card_replacement_image %}
  {% set _card_replacement_image = _card_replacement_image|merge({
    ratio: false,
    cover: true,
  }) %}
{% endif %}

{% if _card_replacement_media_content %}
  {{ _card_replacement_media_content }}
{% else %}
  {% if _card_replacement_image or block('media') is defined %}
    <bolt-card-replacement-media {{ attributes }}>
      <ssr-keep for="bolt-card-replacement-media" class="c-bolt-card_replacement__media">
        {% if _card_replacement_image %}
          {% if _card_replacement_image.src %}
            {% set _image_attributes = _card_replacement_image.attributes|default({}) %}
            {% set _image_attributes = _image_attributes|merge({
              src: _card_replacement_image.src,
              alt: _card_replacement_image.alt,
              srcset: _card_replacement_image.srcset,
              sizes: _card_replacement_image.sizes,
            }) %}

            {% if _card_replacement_image.lazyload == true %}
              {% set _image_attributes = _image_attributes|merge({loading: 'lazy'}) %}
            {% endif %}

            {% if no_lazy == true %}
              {% set _image_attributes = _image_attributes|merge({loading: 'eager'}) %}
            {% endif %}

            {% if _card_replacement_image.max_width %}
              {% set _image_attributes = _image_attributes|merge({
                style: 'max-width: ' ~ _card_replacement_image.max_width ~ ';'
              }) %}
            {% endif %}

            {% set _image_props = { attributes: _image_attributes } %}

            {% if _card_replacement_image.max_width %}
              {% set _image_props = _image_props|merge({fill: true}) %}
            {% endif %}

            {% if _card_replacement_image.cover %}
              {% set _image_props = _image_props|merge({background: true}) %}
            {% endif %}
          {% else %}
            {% set _image_props = _card_replacement_image %}
          {% endif %}

          {% include "@bolt-elements-image/image.twig" with _image_props only %}
        {% elseif block('media') is defined %}
          {{ block('media') }}
        {% endif %}
      </ssr-keep>
    </bolt-card-replacement-media>
  {% endif %}

  {% if (_card_replacement_video.videoId) %}
    {% set _card_replacement_video %}
      {% include '@bolt-components-video/video.twig' with _card_replacement_video only %}
    {% endset %}
  {% endif %}
  {% if _card_replacement_video %}
    <bolt-card-replacement-media {{ attributes }}>
      <ssr-keep for="bolt-card-replacement-media" class="c-bolt-card_replacement__media c-bolt-card_replacement__media--video">
        {{ _card_replacement_video }}
      </ssr-keep>
    </bolt-card-replacement-media>
  {% endif %}
{% endif %}
