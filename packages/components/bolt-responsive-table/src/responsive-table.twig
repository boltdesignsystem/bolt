{% set schema = bolt.data.components['@bolt-components-responsive-table'].schema %}
{% if enable_json_schema_validation %}
  {{ validate_data_schema(schema, _self)|raw }}
{% endif %}

{# Variables #}
{% set this = init(schema) %}
{% set attributes = create_attribute(attributes|default({})) %}

{# Array of classes based on the defined + default props #}
{% set classes = [
  'c-bolt-responsive-table',
] %}

{% set icon_chevron_down %}
  {% include '@bolt-elements-icon/icon.twig' with {
    name: 'chevron-down',
  } only %}
{% endset %}

{% set icon_chevron_up %}
  {% include '@bolt-elements-icon/icon.twig' with {
    name: 'chevron-up',
  } only %}
{% endset %}

{% set icon_filter %}
  {% include '@bolt-elements-icon/icon.twig' with {
    name: 'filter',
  } only %}
{% endset %}

{% set toggle_row_button %}
  {% include '@bolt-elements-button/button.twig' with {
    content: icon_chevron_down,
    size: 'small',
    hierarchy: 'transparent',
    attributes: {
      type: 'button',
      'aria-expanded': 'false',
      'aria-label': 'Toggle row table'
    }
  } only %}
{% endset %}

{% set sort_button %}
  {% set sort_button_wrapper %}
    <div class="icon-wrapper">
      {{ icon_chevron_up }}
      {{ icon_chevron_down }}
    </div>
  {% endset %}
  {% include '@bolt-elements-button/button.twig' with {
    content: sort_button_wrapper,
    size: 'small',
    hierarchy: 'transparent',
    attributes: {
      type: 'button',
      'aria-label': 'Sort by '
    }
  } only %}
{% endset %}

{% set filter_button %}
  {% include '@bolt-elements-button/button.twig' with {
    content: icon_filter,
    size: 'small',
    hierarchy: 'transparent',
    attributes: {
      type: 'button',
      'aria-expanded': 'false',
      'aria-label': 'Filter by '
    }
  } only %}
{% endset %}

<div {{ attributes.addClass(classes) }}>
  <table class="c-bolt-reponsive-table__table">
    {% if table_caption_top or table_caption_bottom %}
      <caption class="c-bolt-reponsive-table__caption--top">{{ table_caption_top }}</caption>
    {% else %}
      <caption class="c-bolt-reponsive-table__caption--bottom">{{ table_caption_bottom }}</caption>
    {% endif %}
    {% if table_headers_top %}
      <thead class="c-bolt-responsive-table__head">
        {% for headers in table_headers_top %}
          <tr class="c-bolt-responsive-table__row">
            {% if table_headers_side %}
              <td></td>
            {% endif %}
            {% for table_header in headers.cells %}
              {% set table_header_attrs = create_attribute(table_header.attributes|default({})) %}
              {% set table_header_classes = [
                'c-bolt-reponsive-table__header',
              ] %}
              <th {{ table_header_attrs.addClass(table_header_classes) }}>
              {% if checkbox and loop.first and not table_headers_side %}
                {% set table_data = headers.cells[loop.index0]|replace({' ': '-'})|lower %}
                  <label class="c-bolt-reponsive-table__cell-label" for="table-data-id-{{ table_data }}">{{ headers.cells[loop.index0] }}</label>
                  <input class="c-bolt-responsive-table__header-checkbox" type="checkbox" id="table-data-id-{{ table_data }}" name="table-data-name-{{ table_data }}" value="{{ table_data }}">
                {% endif %}
              {% if table_header.content %}
                {{ table_header.content }}
              {% else %}
                {{ table_header }}
              {% endif %}
              {% if table_header.sort %}
                {{ sort_button }}
              {% endif %}
              {% if table_header.filters %}
                {{ filter_button }}
              {% endif %}
              </th>
            {% endfor %}
          </tr>
        {% endfor %}
      </thead>
    {% endif %}
    {% if rows %}
      <tbody>
        {% for row in rows %}
          <tr 
            {% if row.trigger %}
              class="c-bolt-responsive-table__row c-bolt-responsive-table__row--trigger"
            {% elseif row.hidden %}
              class="c-bolt-responsive-table__row c-bolt-responsive-table__row--hidden"
            {% else %}
              class="c-bolt-responsive-table__row"
            {% endif %}>
            {% if table_headers_side %}
              {% set index = loop.index0 %}
                {% for headers in table_headers_side %}
                {% set table_header_attrs = create_attribute(table_header.attributes|default({})) %}
                {% set table_header_classes = [
                  'c-bolt-reponsive-table__header',
                ] %}
                  <th {{ table_header_attrs.addClass(table_header_classes) }}>
                    {{ headers.cells[index] }}
                    {% if row.trigger %}
                      {{ toggle_row_button }}
                    {% endif %}
                  </th>
                {% endfor %}
            {% endif %}
            {% for table_data in row.cells %}
              {% set table_data_attrs = create_attribute(table_data.attributes|default({})) %}
              {% set table_data_classes = [
                'c-bolt-reponsive-table__data',
              ] %}
              <td {{ table_data_attrs.addClass(table_data_classes) }}>
                {% if checkbox and loop.first and not table_headers_side %}
                {% set table_data = row.cells[loop.index0]|replace({' ': '-'})|lower %}
                  <label class="c-bolt-reponsive-table__cell-label" for="table-data-id-{{ table_data }}">{{ row.cells[loop.index0] }}</label>
                  <input class="c-bolt-responsive-table__header-checkbox" type="checkbox" id="table-data-id-{{ table_data }}" name="table-data-name-{{ table_data }}" value="{{ table_data }}">
                {% endif %}
                {% if table_data.content %}
                  {{ table_data.content }}
                {% else %}
                  {{ table_data }}
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    {% endif %}
  </table>
</div>

