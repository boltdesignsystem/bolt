{% set schema = bolt.data.components['@bolt-components-responsive-table'].schema %}
{% if enable_json_schema_validation %}
  {{ validate_data_schema(schema, _self)|raw }}
{% endif %}

{# Variables #}
{% set this = init(schema) %}
{% set attributes = create_attribute(attributes|default({})) %}

{# Array of classes based on the defined + default props #}
{% set classes = [
  'c-bolt-responsive-table',
] %}

{% set icon_chevron_down %}
  {% include '@bolt-elements-icon/icon.twig' with {
    name: 'chevron-down',
  } only %}
{% endset %}

{% set icon_chevron_up %}
  {% include '@bolt-elements-icon/icon.twig' with {
    name: 'chevron-up',
  } only %}
{% endset %}

{% set icon_filter %}
  {% include '@bolt-elements-icon/icon.twig' with {
    name: 'filter',
  } only %}
{% endset %}

<div {{ attributes.addClass(classes) }}>
  <table class="c-bolt-responsive-table__table" id="table-id-{{ random() }}">
    {% if table_caption_top %}
      <caption class="c-bolt-responsive-table__caption c-bolt-responsive-table__caption--top">
        {{ table_caption_top }}
      </caption>
    {% else %}
      <caption class="c-bolt-responsive-table__caption c-bolt-responsive-table__caption--bottom">
        {{ table_caption_bottom }}
      </caption>
    {% endif %}
    {% if table_headers_top %}
      <thead class="c-bolt-responsive-table__head">
        {% for headers in table_headers_top %}
          <tr class="c-bolt-responsive-table__row">
            {% if table_headers_side %}
              <th></th>
            {% endif %}
            {% for table_header in headers.cells %}
              {% set table_header_attrs = create_attribute(table_header.attributes|default({})) %}
              {% set table_header_classes = [
                'c-bolt-responsive-table__header',
              ] %}
              <th {{ table_header_attrs.addClass(table_header_classes) }}>
              {% if table_header.sort or table_header.filters %}
                <div class="c-bolt-responsive-table__ctas">
              {% endif %}
              {% if checkbox and loop.first and not table_headers_side %}
                {% set table_data = headers.cells[loop.index0]|replace({' ': '-'})|lower %}
                <label class="c-bolt-responsive-table__cell-label" for="table-data-id-{{ table_data }}">{{ headers.cells[loop.index0] }}</label>
                <input class="c-bolt-responsive-table__header-checkbox" type="checkbox" id="table-data-id-{{ table_data }}" name="table-data-name-{{ table_data }}" value="{{ table_data }}">
              {% endif %}
              {% if table_header.content %}
                {{ table_header.content }}
              {% else %}
                {{ table_header }}
              {% endif %}
              {% if table_header.sort %}
              {% set data %}
              {% if headers.cells[loop.index0] is iterable %}
                {{ headers.cells[loop.index0].content }}
              {% else %}
                {{ headers.cells[loop.index0] }}
              {% endif %}
              {% endset %}
              <button class="c-bolt-responsive-table__button c-bolt-responsive-table__button--sort" type="button" data-sort="{{ data|trim|replace({' ': '-'})|lower }}">
                <div class="c-bolt-responsive-table__trigger-icon">
                  {{ icon_chevron_up }}
                  {{ icon_chevron_down }}
                </div>
              </button>
                {# {{ sort_button }} #}
              {% endif %}
              {% if table_header.filters %}
                <button class="c-bolt-responsive-table__button c-bolt-responsive-table__button--filter" type="button">
                  {# {{ filter_button }} #}
                  {{ icon_filter }}
                </button>
              {% endif %}
              {% if table_header.sort or table_header.filters %}
                </div>
              {% endif %}
              </th>
            {% endfor %}
          </tr>
        {% endfor %}
      </thead>
    {% endif %}
    {% if rows %}
      <tbody class="c-bolt-responsive-table__body">
        {% for row in rows %}
          <tr
            {% if row.trigger %}
              class="c-bolt-responsive-table__row c-bolt-responsive-table__row--trigger"
            {% else %}
              class="c-bolt-responsive-table__row"
            {% endif %}>
            {% if table_headers_side %}
              {% set index = loop.index0 %}
              {% for headers in table_headers_side %}
                {% set table_header_attrs = create_attribute(table_header.attributes|default({})) %}
                {% set table_header_classes = [
                  'c-bolt-responsive-table__header',
                ] %}
                <th {{ table_header_attrs.addClass(table_header_classes) }}>
                  {% if row.trigger %}<div class="c-bolt-responsive-table__header-cta">{% endif %}
                  {% if headers.cells[index] is iterable %}
                    {{ headers.cells[index].content }}
                  {% else %}
                    {{ headers.cells[index] }}
                  {% endif %}
                  {% if row.trigger %}
                    <button class="c-bolt-responsive-table__button c-bolt-responsive-table__button--toggle-row js-bolt-responsive-table-toggle-row" type="button" aria-expanded="false" aria-label="Toggle row table">
                      <div class="c-bolt-responsive-table__trigger-icon" aria-hidden="true">
                        {% include '@bolt-elements-icon/icon.twig' with {
                          name: 'chevron-down',
                        } only %}
                      </div>
                    </button>
                  {% endif %}
                  {% if row.trigger %}</div>{% endif %}
                </th>
              {% endfor %}
            {% endif %}
            {# loop for classes to enable sort #}
              {% set classes_arr = [] %}
              {% for headers in table_headers_top %}
                {% for table_header in headers.cells %}
                {% set header_name %}
                  {% if table_header.content %}
                    {{ table_header.content }}
                  {% else %}
                    {{ table_header }}
                  {% endif %}
                {% endset %}
                {% set classes_arr = classes_arr|merge([header_name]) %}
                {% endfor %}
              {% endfor %}
            {# loop for classes to enable sort #}
            {% for table_data in row.cells %}
              {% set table_data_attrs = create_attribute(table_data.attributes|default({})) %}
              {% set table_data_classes = [
                'c-bolt-responsive-table__data',
                "#{classes_arr[loop.index0]|trim|replace({' ': '-'})|lower}"
              ] %}
              <td {{ table_data_attrs.addClass(table_data_classes) }}>
                {% if checkbox and loop.first and not table_headers_side %}
                {% set table_data = row.cells[loop.index0]|replace({' ': '-'})|lower %}
                  <label class="c-bolt-responsive-table__cell-label" for="table-data-id-{{ table_data }}">{{ row.cells[loop.index0] }}</label>
                  <input class="c-bolt-responsive-table__header-checkbox" type="checkbox" id="table-data-id-{{ table_data }}" name="table-data-name-{{ table_data }}" value="{{ table_data }}">
                {% endif %}
                {% if table_data.content %}
                  {{ table_data.content }}
                {% else %}
                  {{ table_data }}
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    {% endif %}
  </table>
</div>

