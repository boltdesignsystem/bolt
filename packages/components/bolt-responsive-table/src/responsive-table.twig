{% set schema = bolt.data.components['@bolt-components-responsive-table'].schema %}
{% if enable_json_schema_validation %}
  {{ validate_data_schema(schema, _self)|raw }}
{% endif %}

{# Variables #}
{% set this = init(schema) %}
{% set attributes = create_attribute(attributes|default({})) %}

{# Array of classes based on the defined + default props #}
{% set classes = [
  'c-bolt-responsive-table',
  'js-bolt-responsive-table'
] %}

{% set icon_chevron_down %}
  {% include '@bolt-elements-icon/icon.twig' with {
    name: 'chevron-down',
  } only %}
{% endset %}

{% set icon_chevron_up %}
  {% include '@bolt-elements-icon/icon.twig' with {
    name: 'chevron-up',
  } only %}
{% endset %}

{% set icon_filter %}
  {% include '@bolt-elements-icon/icon.twig' with {
    name: 'filter',
  } only %}
{% endset %}

{% set icon_close %}
  {% include '@bolt-elements-icon/icon.twig' with {
    name: 'close-circle',
    size: 'small'
  } only %}
{% endset %}

<div {{ attributes.addClass(classes) }}>
  <table class="c-bolt-responsive-table__table" {% if sort or filters %} id="table-id-{{ random() }} {% endif %}">
    {% if table_caption_top %}
      <caption class="c-bolt-responsive-table__caption c-bolt-responsive-table__caption--top">
        {{ table_caption_top }}
      </caption>
    {% else %}
      <caption class="c-bolt-responsive-table__caption c-bolt-responsive-table__caption--bottom">
        {{ table_caption_bottom }}
      </caption>
    {% endif %}
    {% if table_headers_top %}
      <thead class="c-bolt-responsive-table__head">
        {% for headers in table_headers_top %}
          <tr class="c-bolt-responsive-table__row">
            {% if table_headers_side %}
              <th></th>
            {% endif %}
            {% for table_header in headers.cells %}
              {% set table_header_attrs = create_attribute(table_header.attributes|default({})) %}
              {% set table_header_classes = [
                'c-bolt-responsive-table__header',
              ] %}
              <th {{ table_header_attrs.addClass(table_header_classes) }}>
                {% if sort or filters %}
                  <div class="c-bolt-responsive-table__ctas">
                {% endif %}
                {% if checkbox and loop.first and not table_headers_side %}
                  {% set table_data = headers.cells[loop.index0]|replace({' ': '-'})|lower %}
                  <label class="c-bolt-responsive-table__cell-label" for="table-data-id-{{ table_data }}">{{ headers.cells[loop.index0] }}</label>
                  <input class="c-bolt-responsive-table__header-checkbox" type="checkbox" id="table-data-id-{{ table_data }}" name="table-data-name-{{ table_data }}" value="{{ table_data }}">
                {% endif %}
                {% if table_header.content %}
                  {{ table_header.content }}
                {% else %}
                  {{ table_header }}
                {% endif %}
                {% if sort or filters %}
                {% set data %}
                {% if headers.cells[loop.index0] is iterable %}
                  {{ headers.cells[loop.index0].content }}
                {% else %}
                  {{ headers.cells[loop.index0] }}
                {% endif %}
                {% endset %}
                <button class="c-bolt-responsive-table__button c-bolt-responsive-table__button--sort" type="button" data-sort="c-bolt-responsive-table--sort-{{ data|trim|replace({' ': '-'})|lower }}">
                  <div class="c-bolt-responsive-table__trigger-icon">
                    {{ icon_chevron_up }}
                    {{ icon_chevron_down }}
                  </div>
                </button>
                {% endif %}
                {% if filters %}
                  <button class="c-bolt-responsive-table__button c-bolt-responsive-table__button--filter" type="button" aria-expanded="false">
                    {{ icon_filter }}
                  </button>
                {% endif %}
                {% if sort or filters %}
                  </div>
                {% endif %}
                {% if filters %}
                  <div class="c-bolt-responsive-table__filters">
                    <ul class="c-bolt-responsive-table__filters-list">
                      <li class="c-bolt-responsive-table__filters-item">
                      <label>
                        <input class="c-bolt-responsive-table__filters-checkbox" type="checkbox" />
                        input 1
                      </label>
                      </li>
                      <li class="c-bolt-responsive-table__filters-item">
                        <label>
                          <input class="c-bolt-responsive-table__filters-checkbox" type="checkbox" />
                          input 2
                        </label>
                      </li>
                      <li class="c-bolt-responsive-table__filters-item">
                        <label>
                        <input class="c-bolt-responsive-table__filters-checkbox" type="checkbox" />
                          input 3
                        </label>
                      </li>
                    </ul>
                    <button class="c-bolt-responsive-table__button c-bolt-responsive-table__filters-reset" type="button" aria-label="Reset filters">Reset</button>
                  </div>
                  {# {% if rows %}
                    <div class="c-bolt-responsive-table__filters">
                      {% set start = 0 %}
                      {% for row in rows %}
                        {% for table_data in row.cells|slice(start,1) %}
                          {% if table_data.content %}
                            <p>{{ table_data.content }}</p>
                          {% else %}
                            <p>{{ table_data }}</p>
                          {% endif %}
                        {% endfor %}
                        {% set start = start + 1 %}
                      {% endfor %}
                    </div>
                  {% endif %} #}
                {% endif %}
              </th>
            {% endfor %}
          </tr>
        {% endfor %}
      </thead>
    {% endif %}
    {% if rows %}
      <tbody class="c-bolt-responsive-table__body">
        {% for row in rows %}
          <tr
            {% if row.trigger %}
              class="c-bolt-responsive-table__row c-bolt-responsive-table__row--trigger"
            {% else %}
              class="c-bolt-responsive-table__row"
            {% endif %}>
            {% if table_headers_side %}
              {% set index = loop.index0 %}
              {% for headers in table_headers_side %}
                {% set table_header_attrs = create_attribute(table_header.attributes|default({})) %}
                {% set table_header_classes = [
                  'c-bolt-responsive-table__header',
                ] %}
                <th {{ table_header_attrs.addClass(table_header_classes) }}>
                  {% if row.trigger %}<div class="c-bolt-responsive-table__header-cta">{% endif %}
                  {% if headers.cells[index] is iterable %}
                    {{ headers.cells[index].content }}
                  {% else %}
                    {{ headers.cells[index] }}
                  {% endif %}
                  {% if row.trigger %}
                    <button class="c-bolt-responsive-table__button c-bolt-responsive-table__button--toggle-row js-bolt-responsive-table-toggle-row" type="button" aria-expanded="false" aria-label="Toggle row table">
                      <div class="c-bolt-responsive-table__trigger-icon" aria-hidden="true">
                        {% include '@bolt-elements-icon/icon.twig' with {
                          name: 'chevron-down',
                        } only %}
                      </div>
                    </button>
                  {% endif %}
                  {% if row.trigger %}</div>{% endif %}
                </th>
              {% endfor %}
            {% endif %}
            {# loop for classes to enable sort #}
              {% set classes_arr = [] %}
              {% for headers in table_headers_top %}
                {% for table_header in headers.cells %}
                {% set header_name %}
                  {% if table_header.content %}
                    {{ table_header.content }}
                  {% else %}
                    {{ table_header }}
                  {% endif %}
                {% endset %}
                {% set classes_arr = classes_arr|merge([header_name]) %}
                {% endfor %}
              {% endfor %}
            {# loop for classes to enable sort #}
            {% for table_data in row.cells %}
              {% set table_data_attrs = create_attribute(table_data.attributes|default({})) %}
              {% if table_headers_top %}
                {% set prefix = 'c-bolt-responsive-table--sort-' %}
              {% endif %}
              {% set table_data_classes = [
                'c-bolt-responsive-table__data',
                prefix ~ classes_arr[loop.index0]|trim|replace({' ': '-'})|lower
              ] %}
              <td {{ table_data_attrs.addClass(table_data_classes) }}>
                {% if checkbox and loop.first and not table_headers_side %}
                {% set table_data = row.cells[loop.index0]|replace({' ': '-'})|lower %}
                  <label class="c-bolt-responsive-table__cell-label" for="table-data-id-{{ table_data }}">{{ row.cells[loop.index0] }}</label>
                  <input class="c-bolt-responsive-table__header-checkbox" type="checkbox" id="table-data-id-{{ table_data }}" name="table-data-name-{{ table_data }}" value="{{ table_data }}">
                {% endif %}
                {% if table_data.content %}
                  {{ table_data.content }}
                {% else %}
                  {{ table_data }}
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    {% endif %}
  </table>
</div>

