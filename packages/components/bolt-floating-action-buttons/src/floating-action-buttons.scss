/* ------------------------------------ *\
  Floating Action Buttons
\* ------------------------------------ */

@import '@bolt/core-v3.x';

$_bolt-fab-placement-x: var(--bolt-spacing-x-small);
$_bolt-fab-placement-y: var(--bolt-spacing-y-small);
$_bolt-fab-list-gap: var(--bolt-spacing-y-xsmall);

.c-bolt-floating-action-buttons {
  --c-bolt-floating-action-buttons-offset-x: 0px;
  --c-bolt-floating-action-buttons-offset-y: 0px;

  position: fixed;
  right: var(--c-bolt-floating-action-buttons-offset-x, $_bolt-fab-placement-x);
  z-index: bolt-z-index('fab');
  transition: opacity var(--bolt-transition);
  transition-delay: var(--bolt-transition-timing); // Allow children elements to transition first, and then fade in the entire container.

  // must both be ready && not have c-bolt-floating-action-buttons--hidden class before showing
  &:not([data-bolt-ready]),
  &.c-bolt-floating-action-buttons--hidden {
    visibility: hidden;
    opacity: 0;
  }
}

.c-bolt-floating-action-buttons--placement-right {
  top: calc(var(--c-bolt-floating-action-buttons-offset-y) + 50%);
  transform: translateY(-50%);
}

.c-bolt-floating-action-buttons--placement-right-start {
  top: calc(var(--c-bolt-floating-action-buttons-offset-y, $_bolt-fab-placement-y) + var(--bolt-page-header-height));
}

.c-bolt-floating-action-buttons--placement-right-end {
  bottom: var(--c-bolt-floating-action-buttons-offset-y, $_bolt-fab-placement-y);
}

// placement prop
// @todo: can't figure out what's wrong with this logic, CSS isn't compiling correctly.

// $_bolt-fab-placement: 'right-end', 'right', 'right-start';
// @each $placement in $_bolt-fab-placement {
//   .c-bolt-floating-action-buttons--placement-#{$placement} {
//     @if index($placement, 'right') {
//       top: calc(50% + var(--c-bolt-floating-action-buttons-offset-y));
//       transform: translateY(-50%);
//     } @else if index($placement, 'right-top') {
//       top: var(--c-bolt-floating-action-buttons-offset-y, $_bolt-fab-placement-y);
//     } @else {
//       bottom: var(
//         --c-bolt-floating-action-buttons-offset-y,
//         $_bolt-fab-placement-y
//       );
//     }
//   }
// }

.c-bolt-floating-action-buttons__list {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: $_bolt-fab-list-gap;
  margin: 0;
  padding: 0;
  list-style: none;
}

.c-bolt-floating-action-buttons__list-item {
  margin: 0;
  padding: 0;
}

.c-bolt-floating-action-buttons__list-item--has-children {
  display: flex;
  flex-direction: column-reverse;
  
  // Animate "more icon" and "close icon" in toggle button
  .e-bolt-button[aria-expanded] {
    z-index: 1; // Raises the toggle button's stacking context higher than children list.
  }

  .e-bolt-button[aria-expanded='true'] {
    > span:nth-child(1) {
      visibility: hidden;
      opacity: 0;
    }
  
    > span:nth-child(2) {
      visibility: visible;
      opacity: 1;
    }
  }
  
  .e-bolt-button[aria-expanded='false'] {
    > span:nth-child(2) {
      visibility: hidden;
      opacity: 0;
    }
  }

  // Animate children list
  .c-bolt-floating-action-buttons__list {
    opacity: 1;
    max-height: 50vh;
    transition: max-height calc(var(--bolt-transition-timing) * 2) var(--bolt-transition-ease), opacity calc(var(--bolt-transition-timing) * 2) var(--bolt-transition-ease);
  }

  .c-bolt-floating-action-buttons__list--hidden {
    visibility: hidden;
    opacity: 0;
    max-height: 0;
    margin: 0;
    transition: max-height var(--bolt-transition);
  }

  .c-bolt-floating-action-buttons__list-item {
    opacity: 1;
    transform: translate3d(0, 0, 0);
    transition: opacity var(--bolt-transition), transform var(--bolt-transition);

    &:first-of-type {
      margin-top: $_bolt-fab-list-gap;
    }

    &:last-of-type {
      margin-bottom: calc(#{$_bolt-fab-list-gap} * 2);
    }
  }

  .c-bolt-floating-action-buttons__list-item--hidden {
    opacity: 0;
    transform: translate3d(0, 100%, 0);
  }
}

// Remove transitions when @media (prefers-reduced-motion) {} is true.
@media (prefers-reduced-motion) {
  .c-bolt-floating-action-buttons,
  .c-bolt-floating-action-buttons * {
    transition: none !important;
  }
}
