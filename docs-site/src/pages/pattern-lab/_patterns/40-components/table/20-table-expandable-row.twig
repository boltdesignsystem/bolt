{% set description %}
  Table with expandable rows.
{% endset %}

{% set notes %}
  <bolt-ol>
    <bolt-li>List out important information about this component and its usage.</bolt-li>
  </bolt-ol>
{% endset %}

{% set demo %}
  {% set header %}
    {% set cells %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: '',
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'Build',
        header: true,
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'Item number',
        header: true,
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'Description',
        header: true,
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'Assemblies',
        header: true,
      } only %}
    {% endset %}
    {% include '@bolt-components-table/table-row.twig' with {
      content: cells,
    } only %}
  {% endset %}

  {% set row1 %}
    {% set cells %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: '',
        header: true,
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'Build 2.0.1.0 — SR-49969',
        header: true,
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'SR-49941',
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'This hotfix changes Updater requirements for .NET. If you are using Updater with 7.1 or 8.0 Robotic Automation Runtime clients, you now need to have both .NET 4.0 and .NET 3.5 installed.',
      } only %}
      {% set files %}
        OpenSpan.UpdaterService.Remoting.dll<br>
        OpenSpan.Updater.ServerClientInterface.dll<br>
        OpenSpan.Updater.ScheduledTasks.dll<br>
        OpenSpan.Updater.PrePostOperation.dll<br>
        OpenSpan.Updater.Git.dll<br>
        OpenSpan.VersionFinder.exe<br>
        OpenSpan.UpdaterService.exe<br>
        OpenSpan.Updater.X509tool.exe<br>
        OpenSpan.Updater.UserHelper.exe<br>
        OpenSpan.Updater.UninstallHelper.exe<br>
        OpenSpan.Updater.RuntimeLauncher.exe<br>
        OpenSpan.Updater.InstallHelper.exe<br>
        OpenSpan.Updater.Initializer.exe
      {% endset %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: files,
      } only %}
    {% endset %}
    {% include '@bolt-components-table/table-row.twig' with {
      content: cells,
    } only %}
  {% endset %}

  {% set row2_expandable %}
    {% set cells %}
      {% set expand_button %}
        {% include '@bolt-components-table/table-expand-button.twig' with {
          content: 'Expand next 2 rows',
        } only %}
      {% endset %}

      {% include '@bolt-components-table/table-cell.twig' with {
        content: expand_button,
        header: true,
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'Build 1.1.360 — SR-44891',
        header: true,
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'SR-44869',
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'This hotfix changes the system to better handle long file names. It also enhances VersionFinder to sort the list of branches, making it easier to find a specific branch.',
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'OpenSpan.Updater.Git.dll',
      } only %}
    {% endset %}
    {% include '@bolt-components-table/table-row.twig' with {
      content: cells,
      attributes: {
        class: [
          'js-bolt-row-trigger'
        ]
      }
    } only %}
  {% endset %}

  {% set row3_hidden %}
    {% set cells %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: '',
        attributes: {
          colspan: 2,
        },
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'SR-44850',
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'This hotfix changes Updater to avoid an exception that could prevent it from correctly populating branches.',
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'ManagedOpenSsl.dll',
      } only %}
    {% endset %}
    {% include '@bolt-components-table/table-row.twig' with {
      content: cells,
      attributes: {
        id: 'hidden-row-1',
        class: ['u-bolt-hidden']
      },
    } only %}
  {% endset %}

  {% set row4_hidden %}
    {% set cells %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: '',
        attributes: {
          colspan: 2,
        },
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'SR-43163',
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'This hotfix adds a list of post-update tasks to the RuntimeConfig.xml file. These tasks are run after files that match a pattern you specify are updated.',
      } only %}
      {% set files %}
        OpenSpan.Updater.Git.dll<br>
        OpenSpan.Updater.Initializer.exe<br>
        OpenSpan.Updater.InstallHelper.exe<br>
        OpenSpan.Updater.PrePostOperation.dll<br>
        OpenSpan.Updater.PreReqCheck.dll<br>
        OpenSpan.Updater.RuntimeLauncher.exe<br>
        OpenSpan.Updater.ScheduledTasks.dll<br>
        OpenSpan.Updater.ServerClientInterface.dll<br>
        OpenSpan.Updater.ServerClientInterface.Tester.exe<br>
        OpenSpan.Updater.UninstallHelper.exe<br>
        OpenSpan.Updater.UserHelper.exe<br>
        OpenSpan.Updater.X509tool.exe<br>
        OpenSpan.UpdaterService.Remoting.dll<br>
        OpenSpan.UpdaterService.exe
      {% endset %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: files,
      } only %}
    {% endset %}
    {% include '@bolt-components-table/table-row.twig' with {
      content: cells,
      attributes: {
        id: 'hidden-row-2',
        class: ['u-bolt-hidden']
      },
    } only %}
  {% endset %}

  {% set row5 %}
    {% set cells %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: '',
        header: true,
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'Build 1.1.354 — SR-44889',
        header: true,
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'SR-44850',
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'This hotfix changes Updater to avoid an exception that could prevent it from correctly populating branches.',
      } only %}
      {% include '@bolt-components-table/table-cell.twig' with {
        content: 'ManagedOpenSsl.dll',
      } only %}
    {% endset %}
    {% include '@bolt-components-table/table-row.twig' with {
      content: cells,
    } only %}
  {% endset %}

  {% include '@bolt-components-table/table.twig' with {
    header: {
      content: header
    },
    body: {
      content: [
        row1,
        row2_expandable,
        row3_hidden,
        row4_hidden,
        row5,
      ],
      attributes: {},
    },
  } only %}
{% endset %}

{% set twig_markup %}{% verbatim %}
{% endverbatim %}{% endset %}

{% set demo_js %}
<script>
  //nextUntil.js method https://vanillajstoolkit.com/helpers/nextuntil/
  var nextUntil = function(elem, selector, filter) {
    var siblings = [];

    elem = elem.nextElementSibling;

    while (elem) {
      if (elem.matches(selector)) break;

      if (filter && !elem.matches(filter)) {
        elem = elem.nextElementSibling;
      }
      siblings.push(elem);
      elem = elem.nextElementSibling;
    }

    return siblings;
  };

  var start = document.querySelectorAll(
    '.js-bolt-row-trigger',
  );

  for (let i = 0; i < start.length; i++) {
    const tableButton = start[i].querySelector(
      '.js-bolt-toggle-button',
    );

    var next = nextUntil(start[i], '.js-bolt-row-trigger');

    tableButton.addEventListener('click', () => {
      var next = nextUntil(
        start[i],
        '.js-bolt-row-trigger',
      );
      next.forEach(el => {
        if (el.id.indexOf('hidden-row-') != -1) {
          el.classList.toggle('u-bolt-hidden');
        }
      });
    });
  }

  function toggleAriaExpanded() {
    const tableButton = document.querySelectorAll(
      '.js-bolt-toggle-button',
    );
    tableButton.forEach(el => {
      el.addEventListener('click', () => {
        if (el.getAttribute('aria-expanded') === 'true') {
          el.setAttribute('aria-expanded', 'false');
        } else {
          el.setAttribute('aria-expanded', 'true');
        }
      });
    });
  }

  toggleAriaExpanded()
</script>
{% endset %}

{% include '@utils/pattern-doc-page.twig' with {
  title: 'Table with expandable rows',
  description: description,
  notes: notes,
  demo: demo,
  twig_markup: twig_markup,
  js: demo_js,
} only %}

{{ demo_js }}
