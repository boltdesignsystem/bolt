{% extends "@bolt-academy/_academy-landing-page-template.twig" %}

{% import "@bolt-academy/_macros.twig" as macros %}

{% block page_content %}

  {% embed "@bolt-academy/_landing-page-inner-layout.twig" %}

    {% block hero_content %}
      {% include "@bolt-academy/_landing-page-hero.twig" %}
    {% endblock %}

    {% block main_content %}

      {% set trainingList %}
        {% set checkbox_element %}
          {% include "@bolt-academy/_hide-show-completed.twig" with {
            hideCompleted: hideCompleted | default(false)
          } only %}
        {% endset %}

        {% if items %}
          {% set main_content %}

            <bolt-grid gutter="medium" row-gutter="medium">

              {% if hideCompleted %}
                {% set numberOfCompletedItems = 0 %}
                {% set itemsConsolidated = [] %}

                  {% for item in items %}
                    {% if item.completed %}
                      {% set numberOfCompletedItems = numberOfCompletedItems + 1 %}
                      {% if loop.last %}
                        {% set itemsConsolidated = itemsConsolidated | merge([numberOfCompletedItems]) %}
                      {% endif %}
                    {% else %}
                      {% if numberOfCompletedItems != 0 %}
                        {% set itemsConsolidated = itemsConsolidated | merge([
                          macros.include("@bolt-academy/_horizontal-divider.twig", { dividerText: "Completed (" ~ numberOfCompletedItems ~ ")" })
                        ]) %}
                        {% set numberOfCompletedItems = 0 %}
                      {% endif %}
                      {% set itemsConsolidated = itemsConsolidated | merge([item]) %}
                    {% endif %}
                  {% endfor %}
                {% else %}
                  {% set itemsConsolidated = items %}
                {% endif %}

                {% for item in itemsConsolidated %}
                  <bolt-grid-item column-start="1" column-span="12">
                    {% if item.cardTitle %}
                      {% include "@bolt-academy/_horizontal-card.twig" with item %}
                    {% else %}
                      {{ item }}
                    {% endif %}
                  </bolt-grid-item>

                  {% if not loop.last %}
                    <bolt-grid-item column-start="1" column-span="12">
                      {% include "@bolt-academy/_card-spacer.twig" %}
                    </bolt-grid-item>
                  {% endif %}
              {% endfor %}
            </bolt-grid>
          {% endset %}
        {% endif %}
        {% include '@bolt-components-grid/grid.twig' with {
          items: [
            {
              column_start: '1 2@small',
              column_span: '12 10@small',
              content: checkbox_element,
            },
            {
              column_start: '1 2@small',
              column_span: '12 10@small',
              content: main_content,
            },
          ]
        } only %}
      {% endset %}

      {% embed "@bolt-academy/_landing-page-main-1-col.twig" %}
        {% block supplemental_content %}
          {{ trainingList }}
        {% endblock %}
      {% endembed %}

    {% endblock %}
  {% endembed %}

{% endblock %}
